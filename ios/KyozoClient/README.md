# Kyozo iOS Client

A Swift client library for the Kyozo API, with full support for workspaces, files, notebooks, AI services, and the Virtual File System (VFS).

## Installation

### Swift Package Manager

Add this to your `Package.swift`:

```swift
dependencies: [
    .package(url: "https://github.com/kyozo/kyozo-ios-client.git", from: "1.0.0")
]
```

Or add it in Xcode:
1. File → Add Package Dependencies
2. Enter the repository URL
3. Choose version and add to your project

## Quick Start

```swift
import KyozoClient

// Initialize client
let client = KyozoClient(
    baseURL: URL(string: "https://api.kyozo.app/api/v1")!,
    bearerToken: "your-api-token"
)

// List teams
let teams = try await client.teams.list()

// Create a markdown file
let file = try await client.files.create(
    teamId: teamId,
    request: CreateFileRequest(
        name: "notes.md",
        content: "# My Notes\n\nHello world!"
    )
)

// Open as notebook
let notebook = try await client.notebooks.createFromFile(
    teamId: teamId,
    fileId: file.id
)

// Execute code blocks
let result = try await client.notebooks.execute(
    teamId: teamId,
    id: notebook.id
)
```

## Virtual File System (VFS)

The VFS provides automatic documentation generation based on your project type:

```swift
// List files including virtual ones
let listing = try await client.vfs.list(
    teamId: teamId,
    workspaceId: workspaceId
)

// Virtual files are marked with virtual: true
let virtualFiles = listing.files.filter { $0.virtual }
for file in virtualFiles {
    print("✨ \(file.name) - generated by \(file.generator ?? "unknown")")
}

// Read virtual file content
let guide = try await client.vfs.readContent(
    teamId: teamId,
    workspaceId: workspaceId,
    path: "guide.md"
)
print(guide.content)
```

### Common Virtual Files

- `guide.md` - Project-specific development guide
- `deploy.md` - Deployment instructions
- `overview.md` - Workspace overview
- `getting-started.md` - Quick start guide

### VFS Generators

The VFS automatically detects project types and generates appropriate documentation:

- **Elixir/Phoenix** - Phoenix tips, Mix tasks, deployment guides
- **Node.js** - NPM scripts, package info, deployment
- **Python** - Virtual environment setup, pip instructions
- **Docker** - Container guides, compose tips

## SwiftUI Integration

The client includes SwiftUI views and models for easy integration:

```swift
import SwiftUI
import KyozoClient

struct MyApp: View {
    @StateObject private var browser: VFSBrowser
    
    init(client: KyozoClient, teamId: String, workspaceId: String) {
        _browser = StateObject(wrappedValue: VFSBrowser(
            client: client,
            teamId: teamId,
            workspaceId: workspaceId
        ))
    }
    
    var body: some View {
        NavigationView {
            VFSFileListView(browser: browser)
        }
    }
}
```

## AI Services

Get intelligent code suggestions and analysis:

```swift
// Get code suggestions
let suggestions = try await client.ai.suggest(
    request: AISuggestRequest(
        text: "func calculate",
        context: "swift_function"
    )
)

// Analyze code confidence
let analysis = try await client.ai.analyzeConfidence(
    request: AIConfidenceRequest(
        text: "func sum(a: Int, b: Int) -> Int { return a + b }",
        language: "swift"
    )
)
print("Confidence: \(analysis.confidenceScore)")
```

## Caching

The client includes a simple caching system for VFS content:

```swift
let cache = VFSCache(cacheTimeout: 300) // 5 minutes

// Read with caching
let content = try await client.vfs.readContentCached(
    teamId: teamId,
    workspaceId: workspaceId,
    path: "guide.md",
    cache: cache
)
```

## Error Handling

```swift
do {
    let teams = try await client.teams.list()
} catch KyozoError.unauthorized {
    print("Invalid API token")
} catch KyozoError.rateLimited {
    print("Too many requests - wait a bit")
} catch KyozoError.serverError(let message, let details) {
    print("Server error: \(message)")
} catch {
    print("Unexpected error: \(error)")
}
```

## Combine Support

For Combine-based apps:

```swift
import Combine

client.vfsListingPublisher(
    teamId: teamId,
    workspaceId: workspaceId
)
.sink(
    receiveCompletion: { completion in
        if case .failure(let error) = completion {
            print("Error: \(error)")
        }
    },
    receiveValue: { listing in
        print("Files: \(listing.files.count)")
    }
)
.store(in: &cancellables)
```

## Advanced VFS Usage

### Browse by Generator Type

```swift
let listing = try await client.vfs.list(teamId: teamId, workspaceId: workspaceId)

// Group virtual files by generator
let filesByGenerator = Dictionary(grouping: listing.files.filter { $0.virtual }) { 
    $0.generator ?? "unknown"
}

// Get all Python project guides
if let pythonFiles = filesByGenerator["python_project"] {
    for file in pythonFiles {
        let content = try await client.vfs.readContent(
            teamId: teamId,
            workspaceId: workspaceId,
            path: file.path
        )
        // Process Python-specific guides
    }
}
```

### Create Files That Trigger VFS

When you create certain files, the VFS automatically generates helpful guides:

```swift
// Create a Dockerfile - VFS will generate container guides
let dockerfile = try await client.files.create(
    teamId: teamId,
    request: CreateFileRequest(
        name: "Dockerfile",
        content: "FROM node:18\nWORKDIR /app\nCOPY . .\nCMD [\"npm\", \"start\"]"
    )
)

// List files again - VFS will now include container-guide.md
let listing = try await client.vfs.list(teamId: teamId, workspaceId: workspaceId)
let containerGuide = listing.files.first { $0.name == "container-guide.md" }
```

## Requirements

- iOS 16.0+ / macOS 13.0+
- Swift 5.9+
- Xcode 15.0+

## License

MIT License - see LICENSE file for details